generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id
  email     String?  @unique
  password  String
  role      Role
  profile   Profile?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Profile {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  email     String?
  phone     String?
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @unique
  type      ProfileType
  student   Student?
  staff     Staff?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Student {
  id          String    @id @default(cuid())
  profile     Profile   @relation(fields: [profileId], references: [id])
  profileId   String    @unique
  learnerId   String    @unique
  grade       GradeLevel
  section     String?
  guardians   Json?
  enrollments Enrollment[]
  attendance  Attendance[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Staff {
  id        String   @id @default(cuid())
  profile   Profile  @relation(fields: [profileId], references: [id])
  profileId String   @unique
  tsNumber  String   @unique
  position  StaffRole
  subjects  Json?
  classes   Class[]   @relation("ClassInstructor")
  attendance Attendance[]
  announcements Announcement[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Class {
  id          String       @id @default(cuid())
  name        String
  grade       GradeLevel
  section     String?
  capacity    Int?
  instructor  Staff?       @relation("ClassInstructor", fields: [instructorId], references: [id])
  instructorId String?
  schedules   Schedule[]
  enrollments Enrollment[]
  attendance  Attendance[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Schedule {
  id        String   @id @default(cuid())
  class     Class    @relation(fields: [classId], references: [id])
  classId   String
  weekday   Int
  startTime DateTime
  endTime   DateTime
}

model Enrollment {
  id        String  @id @default(cuid())
  student   Student @relation(fields: [studentId], references: [id])
  studentId String
  class     Class   @relation(fields: [classId], references: [id])
  classId   String
}

model Attendance {
  id        String        @id @default(cuid())
  date      DateTime
  status    AttendanceStatus
  student   Student       @relation(fields: [studentId], references: [id])
  studentId String
  class     Class         @relation(fields: [classId], references: [id])
  classId   String
  markedBy  Staff?        @relation(fields: [staffId], references: [id])
  staffId   String?
}

model Announcement {
  id        String     @id @default(cuid())
  title     String
  body      String
  audience  Audience
  published Boolean    @default(false)
  createdBy Staff?     @relation(fields: [staffId], references: [id])
  staffId   String?
  createdAt DateTime    @default(now())
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
  GUARDIAN
}

enum ProfileType {
  ADMIN
  STAFF
  LEARNER
}

enum GradeLevel {
  FORM1
  FORM2
  FORM3
  FORM4
  GRADE10
  GRADE11
  GRADE12
}

enum StaffRole {
  ADMIN
  DEPUTY
  HOD
  TEACHER
  SUPPORT
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum Audience {
  ALL
  STAFF
  STUDENTS
  GUARDIANS
}
